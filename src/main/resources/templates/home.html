<!-- src/main/resources/templates/home.html -->

<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <!-- 添加响应式元标签 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>天气监测系统</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <!-- 引入 Font Awesome 图标库（可选，如果不再使用，可以移除） -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-pjw1b5k5WkP/lvGQ6kHjTphPo4KZx8BvK7Z4KKn/8L5P7WHPFehrPZ3Gv8q/YymrRgrH5fEmRLYzG0a8IcYw7Q==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
    <style>
        /* 定义 CSS 变量 */
        :root {
            --primary-color: #4B7BDB; /* 主色调 RGB(75, 123, 219) */
            --primary-hover-color: #3A69C8;
            --background-color: #f5f5f7;
            --form-background: #ffffff;
            --text-color: #333333;
            --label-color: #555555;
            --error-color: #f44336;
        }
        #citySearch {
            width: 100%;
            padding: 10px;
            font-size: 1em;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }

        #subscriptionList {
            margin-top: 20px;
        }
        .subscription-item {
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 5px;
            margin-bottom: 10px;
            cursor: pointer;
        }
        .subscription-item:hover {
            background-color: #f0f0f0;
        }
        /* 整体页面样式 */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--background-color);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .subscription-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            /* 保留您原有的样式 */
        }

        .delete-btn {
            background-color: rgba(255, 255, 255, 0.5); /* 半透明白色背景 */
            color: #333; /* 文本颜色 */
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 16px;
            line-height: 16px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.3s;
        }

        .delete-btn:hover {
            background-color: rgba(255, 255, 255, 0.7); /* 悬停时略微减少透明度 */
            transform: scale(1.1);
        }

        .delete-btn:active {
            transform: scale(0.95);
        }

        .delete-btn:focus {
            outline: none;
        }
        .container {
            width: 88vw; /* 占据视口宽度的88% */
            height: 88vh; /* 占据视口高度的88% */
            max-width: 1400px; /* 最大宽度 */
            max-height: 1400px; /* 最大高度 */
            padding: 20px;
            display: grid;
            grid-template-areas:
                "current-weather pressure-data future-weather alert-data"
                "weather-state pressure-data future-weather alert-data";
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); /* 自适应列 */
            grid-template-rows: auto;
            gap: 20px;
            box-sizing: border-box;
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: auto; /* 防止内容溢出 */
        }

        /* 大模块样式 */
        .weather-module {
            background-color: #ffffff;
            border-radius: 20px;
            padding: 0; /* 移除外部 padding */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: box-shadow 0.3s;
            position: relative;
            overflow: hidden; /* 保证内容不会溢出 */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* 包装模块内容 */
        .module-content {
            padding: 25px;
            transition: transform 0.3s;
            height: 100%;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            z-index: 1; /* 设置低于 .chart-overlay */
        }

        /* 定义各模块在网格中的位置 */
        #current-weather {
            grid-area: current-weather;
            background-color: #f0f4f8;
        }

        #pressure-data {
            grid-area: pressure-data;
            background-color: #f9fbfc;
        }

        #future-weather {
            grid-area: future-weather;
            background-color: #f0f4f8;
        }

        #weather-state {
            grid-area: weather-state;
            background-color: #f9fbfc;
        }

        #alert-data {
            grid-area: alert-data;
            background-color: #fff5f5; /* 警报模块特定背景色 */
        }

        /* 为所有模块添加悬浮缩放效果，应用到 .module-content */
        .weather-module:hover .module-content {
            transform: scale(1.03);
        }

        /* 为所有模块添加悬浮阴影效果 */
        .weather-module:hover {
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        /* 每个小数据项样式 */
        .data-item {
            border-bottom: 1px solid #e0e0e0;
            padding: 12px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: opacity 0.3s, transform 0.3s;
        }

        /* 为悬浮模块的内容项添加缩放效果 */
        .weather-module:hover .data-item {
            opacity: 0;
            transform: scale(0.95);
        }

        /* "当前天气" 和 "天气状态" 模块在悬浮时的数据项保持不变 */
        #current-weather:hover .data-item,
        #weather-state:hover .data-item {
            opacity: 1;
            transform: scale(1);
        }

        .data-item:last-child {
            border-bottom: none;
        }

        /* 小数据项标题和内容样式 */
        .data-item h3 {
            margin: 0;
            font-size: 1em;
            color: #555;
        }

        .data-item p {
            margin: 0;
            font-size: 1em;
            color: #333;
            font-weight: 500;
        }

        .data-item .value {
            font-size: 1.2em;
            font-weight: 600;
            color: #000;
        }

        /* 导航按钮样式 */
        .btn-group {
            position: fixed;
            right: 20px;
            bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            z-index: 1000;
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            width: 60px;
            height: 60px;
            border: none;
            border-radius: 50%;
            font-size: 1.5em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.3s, opacity 0.3s, visibility 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn:hover {
            background-color: var(--primary-hover-color);
            transform: scale(1.1);
        }

        /* 点击效果 */
        .btn:active {
            transform: scale(0.95);
        }

        /* 登出按钮样式 */
        .logout-btn {
            background-color: #ff3b30;
        }

        .logout-btn:hover {
            background-color: #e03128;
        }

        /* 子按钮隐藏 */
        .btn-group .btn-child {
            opacity: 0;
            transform: translateY(20px);
            visibility: hidden;
            transition: opacity 0.3s ease, transform 0.3s ease, visibility 0.3s;
        }
        .subscription-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 5px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .subscription-item:hover {
            background-color: #f0f0f0;
        }

        .default-city {
            background-color: rgba(255, 255, 255, 0.5); /* 半透明白色背景 */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);   /* 添加阴影 */
            transform: scale(1.05);                      /* 稍微增大尺寸 */
            transition: all 0.3s ease;
        }
        /* 主按钮激活时显示子按钮 */
        .btn-group.active .btn-child {
            opacity: 1;
            transform: translateY(0);
            visibility: visible;
            transition-delay: 0.1s;
        }

        /* 可视化图表样式 */
        .chart-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #ffffff; /* 不透明背景 */
            opacity: 0;
            visibility: hidden;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            border-radius: 20px;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            z-index: 2; /* 确保在 .module-content 之上 */
        }

        .weather-module:hover .chart-overlay {
            opacity: 1;
            visibility: visible;
        }

        .chart-container {
            width: 100%;
            height: 100%;
        }
        /* 侧边栏样式 */
        .sidebar {
            position: fixed;
            top: 0;
            left: -250px; /* 初始隐藏在左侧 */
            width: 250px;
            height: 100%;
            background-color: var(--primary-color);
            color: white;
            transition: left 0.3s ease;
            z-index: 1000;
            padding: 20px;
            box-sizing: border-box;
        }

        .sidebar-content {
            margin-top: 60px; /* 留出顶部按钮的空间 */
        }

        /* 侧边栏按钮样式 */
        /* 侧边栏按钮样式 */
        .sidebar-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            transition: left 0.3s ease; /* 添加平滑切换动画 */
        }

        /* 右下角按钮样式 */
        .btn {
            background-color: var(--primary-color);
            color: white;
            width: 60px;
            height: 60px;
            border: none;
            border-radius: 50%;
            font-size: 1.5em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.3s, opacity 0.3s, visibility 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn:hover {
            background-color: var(--primary-hover-color);
            transform: scale(1.1);
        }
        /* 下拉框样式 */
        /* 下拉框样式 */
        select {
            width: 100%;
            padding: 10px;
            border: none; /* 移除边框 */
            border-radius: 10px; /* 圆角矩形 */
            background-color: #ffffff; /* 纯白色背景 */
            color: var(--text-color);
            font-size: 1em;
            appearance: none; /* 移除默认箭头 */
            -webkit-appearance: none; /* 移除默认箭头 */
            -moz-appearance: none; /* 移除默认箭头 */
            background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 5"><path fill="none" stroke="%23333" stroke-width=".75" d="M2 0L0 2h4zm0 5L0 3h4z"/></svg>'); /* 自定义箭头 */
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* 添加阴影 */
        }
        /* Add button style */
        .add-btn {
            background-color: rgba(255, 255, 255, 0.5); /* Semi-transparent white */
            color: white;
            width: 45px; /* 75% of 60px (menu button size) */
            height: 45px; /* 75% of 60px (menu button size) */
            border: none;
            border-radius: 50%;
            font-size: 1.125em; /* 75% of 1.5em */
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-top: 20px; /* Add some space above the button */
        }

        .add-btn:hover {
            background-color: rgba(255, 255, 255, 0.7); /* Slightly less transparent on hover */
            transform: scale(1.1);
        }

        .add-btn:active {
            transform: scale(0.95);
        }
        .header-with-button {
            display: flex;
            align-items: center;
            position: relative;
        }

        .add-btn {
            position: absolute;
            top: -70px; /* 25px above the heading */
            right: 5px; /* 25px to the right of the heading */
            background-color: rgba(255, 255, 255, 0.5); /* Semi-transparent white */
            color: white;
            width: 45px; /* 75% of 60px (menu button size) */
            height: 45px; /* 75% of 60px (menu button size) */
            border: none;
            border-radius: 50%;
            font-size: 0.75em; /* 75% of 1.5em */
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .ui-autocomplete {
            z-index: 1000; /* 你可以根据需要调整这个值 */
            position: absolute;
        }

        .add-btn:hover {
            background-color: rgba(255, 255, 255, 0.7); /* Slightly less transparent on hover */
            transform: scale(1.1);
        }

        .add-btn:active {
            transform: scale(0.95);
        }
        /* 特定选项样式 */
        select option[value="beijing"] {
            background-color: #ffffff; /* 北京选项背景色为白色 */
        }
        /* 点击效果 */
        .btn:active {
            transform: scale(0.95);
        }
        /* 响应式设计 */
        @media (max-width: 1200px) {
            .container {
                grid-template-areas:
                    "current-weather pressure-data future-weather"
                    "weather-state pressure-data alert-data";
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
        }

        @media (max-width: 900px) {
            .container {
                grid-template-areas:
                    "current-weather"
                    "pressure-data"
                    "future-weather"
                    "weather-state"
                    "alert-data";
                grid-template-columns: 1fr;
                grid-template-rows: auto;
            }

            .btn-group {
                right: 10px;
                bottom: 10px;
            }

            .btn {
                width: 50px;
                height: 50px;
                font-size: 1.2em;
            }
        }

        @media (max-width: 600px) {
            .container {
                padding: 10px;
                gap: 10px;
            }

            .weather-module {
                padding: 15px;
            }

            .data-item {
                padding: 8px 0;
            }

            .btn-group {
                flex-direction: row;
                bottom: 10px;
                right: 50%;
                transform: translateX(50%);
                gap: 10px;
            }

            .btn {
                width: 40px;
                height: 40px;
                font-size: 1em;
            }
        }
    </style>
    <!-- 引入图表库，例如 Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="sidebar" id="sidebar">
    <div class="sidebar-content">
        <div class="header-with-button">
            <h2>地区选择</h2>
            <button class="add-btn" id="addCityBtn" title="添加" aria-label="添加">
                <!-- Add icon SVG -->
                <svg width="18" height="18" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M24 10V38" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M10 24H38" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
        <div>
            <input type="text" id="citySearch" placeholder="搜索城市..." autocomplete="off">
        </div>
        <!-- 显示用户的订阅列表 -->
        <div id="subscriptionList">
            <h3>您的订阅城市</h3>
            <div id="subscriptions">
                <!-- 动态加载用户的订阅城市 -->
            </div>
        </div>

    </div>
</div>
<button class="sidebar-toggle btn" id="sidebarToggle" title="菜单" aria-label="菜单">
    <!-- 菜单图标 SVG -->
    <?xml version="1.0" encoding="UTF-8"?>
    <svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M4 42H44" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
        <rect x="8" y="22" width="12" height="20" rx="2" fill="none" stroke="#ffffff" stroke-width="4" stroke-linejoin="round"/>
        <rect x="20" y="4" width="20" height="38" rx="2" fill="none" stroke="#ffffff" stroke-width="4" stroke-linejoin="round"/>
        <path d="M28 32.0083H32" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M12 32.0083H16" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M28 23.0083H32" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M28 14.0083H32" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
    </svg></button>
<div class="container">
    <!-- 当前天气模块 -->
    <div class="weather-module" id="current-weather">
        <div class="module-content">
            <h2>当前天气</h2>
            <div class="data-item">
                <h3>温度</h3>
                <p class="value" id="current-temp">--</p>
            </div>
            <div class="data-item">
                <h3>湿度</h3>
                <p class="value" id="current-humidity">--</p>
            </div>
            <div class="data-item">
                <h3>紫外线</h3>
                <p class="value" id="current-uv">--</p>
            </div>
            <div class="chart-overlay">
                <canvas id="currentWeatherChart"></canvas>
            </div>
        </div>
    </div>

    <!-- 气象数据模块 -->
    <div class="weather-module" id="pressure-data">
        <div class="module-content">
            <h2>气象数据</h2>
            <div class="data-item">
                <h3>大气压</h3>
                <p class="value" id="pressure">--</p>
            </div>
            <div class="data-item">
                <h3>能见度</h3>
                <p class="value" id="visibility">--</p>
            </div>
            <div class="data-item">
                <h3>空气质量</h3>
                <p class="value" id="air-quality">--</p>
            </div>
            <div class="data-item">
                <h3>降水量</h3>
                <p class="value" id="precip">--</p>
            </div>
            <div class="chart-overlay">
                <canvas id="pressureDataChart"></canvas>
            </div>
        </div>
    </div>

    <!-- 未来天气预报模块 -->
    <!-- 未来天气预报模块 -->
    <div class="weather-module" id="future-weather">
        <div class="module-content">
            <h2>未来七天天气预报</h2>
            <div class="data-item">
                <h3><span id="future-day-0">--</span> (<span id="future-date-0">--</span>)</h3>
                <p class="value" id="future-temp-0">--</p>
            </div>
            <div class="data-item">
                <h3><span id="future-day-1">--</span> (<span id="future-date-1">--</span>)</h3>
                <p class="value" id="future-temp-1">--</p>
            </div>
            <div class="data-item">
                <h3><span id="future-day-2">--</span> (<span id="future-date-2">--</span>)</h3>
                <p class="value" id="future-temp-2">--</p>
            </div>
            <div class="data-item">
                <h3><span id="future-day-3">--</span> (<span id="future-date-3">--</span>)</h3>
                <p class="value" id="future-temp-3">--</p>
            </div>
            <div class="data-item">
                <h3><span id="future-day-4">--</span> (<span id="future-date-4">--</span>)</h3>
                <p class="value" id="future-temp-4">--</p>
            </div>
            <div class="data-item">
                <h3><span id="future-day-5">--</span> (<span id="future-date-5">--</span>)</h3>
                <p class="value" id="future-temp-5">--</p>
            </div>
            <div class="data-item">
                <h3><span id="future-day-6">--</span> (<span id="future-date-6">--</span>)</h3>
                <p class="value" id="future-temp-6">--</p>
            </div>
            <div class="chart-overlay">
                <canvas id="futureWeatherChart"></canvas>
            </div>
        </div>
    </div>
    <!-- 天气状态模块 -->
    <div class="weather-module" id="weather-state">
        <div class="module-content">
            <h2>天气状态</h2>
            <div class="data-item">
                <h3>当前状态</h3>
                <p class="value" id="current-state">--</p>
            </div>
            <div class="chart-overlay">
                <canvas id="weatherStateChart"></canvas>
            </div>
        </div>
    </div>

    <!-- 重要警报数据模块 -->
    <div class="weather-module" id="alert-data">
        <div class="module-content">
            <h2>重要警报</h2>
            <div class="data-item">
                <h3>警报类型</h3>
                <p class="value" id="alert-type">--</p>
            </div>
            <div class="data-item">
                <h3>严重程度</h3>
                <p class="value" id="alert-severity">--</p>
            </div>
            <div class="data-item">
                <h3>生效时间</h3>
                <p class="value" id="alert-time">--</p>
            </div>
            <div class="chart-overlay">
                <canvas id="alertDataChart"></canvas>
            </div>
        </div>
    </div>

    <!-- 导航按钮 -->
    <div class="btn-group" id="btnGroup">
        <!-- 更换图标为SVG并确保颜色为白色 -->
        <a href="/logout" class="btn btn-child logout-btn" title="登出" aria-label="登出">
            <!-- 锁图标 SVG -->
            <svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M23.9917 6H6V42H24" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M33 33L42 24L33 15" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M16 23.9917H42" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </a>
        <button class="btn btn-child" onclick="refreshData()" title="刷新" aria-label="刷新">
            <!-- 刷新图标 SVG -->
            <svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M42 8V24" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M6 24L6 40" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M42 24C42 14.0589 33.9411 6 24 6C18.9145 6 14.3216 8.10896 11.0481 11.5M6 24C6 33.9411 14.0589 42 24 42C28.8556 42 33.2622 40.0774 36.5 36.9519" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
        <button class="btn btn-child" onclick="importData()" title="导入" aria-label="导入">
            <!-- 下载图标 SVG -->
            <svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M24.0079 41L23.9995 23" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M40.5178 34.3161C43.8044 32.005 45.2136 27.8302 44.0001 24C42.7866 20.1698 39.0705 18.0714 35.0527 18.0745H32.7317C31.2144 12.1613 26.2082 7.79572 20.1435 7.0972C14.0787 6.39868 8.21121 9.5118 5.38931 14.9253C2.56741 20.3388 3.37545 26.9317 7.42115 31.5035" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M30.3638 27.6359L23.9998 21.272L17.6358 27.6359" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
        <button class="btn btn-child" onclick="openSettings()" title="设置" aria-label="设置">
            <!-- 齿轮图标 SVG -->
            <svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18.2838 43.1713C14.9327 42.1736 11.9498 40.3213 9.58787 37.867C10.469 36.8227 11 35.4734 11 34.0001C11 30.6864 8.31371 28.0001 5 28.0001C4.79955 28.0001 4.60139 28.01 4.40599 28.0292C4.13979 26.7277 4 25.3803 4 24.0001C4 21.9095 4.32077 19.8938 4.91579 17.9995C4.94381 17.9999 4.97188 18.0001 5 18.0001C8.31371 18.0001 11 15.3138 11 12.0001C11 11.0488 10.7786 10.1493 10.3846 9.35011C12.6975 7.1995 15.5205 5.59002 18.6521 4.72314C19.6444 6.66819 21.6667 8.00013 24 8.00013C26.3333 8.00013 28.3556 6.66819 29.3479 4.72314C32.4795 5.59002 35.3025 7.1995 37.6154 9.35011C37.2214 10.1493 37 11.0488 37 12.0001C37 15.3138 39.6863 18.0001 43 18.0001C43.0281 18.0001 43.0562 17.9999 43.0842 17.9995C43.6792 19.8938 44 21.9095 44 24.0001C44 25.3803 43.8602 26.7277 43.594 28.0292C43.3986 28.01 43.2005 28.0001 43 28.0001C39.6863 28.0001 37 30.6864 37 34.0001C37 35.4734 37.531 36.8227 38.4121 37.867C36.0502 40.3213 33.0673 42.1736 29.7162 43.1713Z" fill="none" stroke="#ffffff" stroke-width="4" stroke-linejoin="round"/>
                <path d="M24 31C27.866 31 31 27.866 31 24C31 20.134 27.866 17 24 17C20.134 17 17 20.134 17 24C17 27.866 20.134 31 24 31Z" fill="none" stroke="#ffffff" stroke-width="4" stroke-linejoin="round"/>
            </svg>
        </button>
        <button class="btn" id="mainBtn" title="菜单" aria-label="菜单">
            <!-- 菜单图标 SVG -->
            <svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M7.94971 11.9497H39.9497" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M7.94971 23.9497H39.9497" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M7.94971 35.9497H39.9497" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
    </div>
</div>

<script>
    // 定义全局变量存储图表实例
    let currentWeatherChart, pressureDataChart, futureWeatherChart, weatherStateChart, alertDataChart;
    let currentRegionId = null;
    // 初始化图表
    document.addEventListener("DOMContentLoaded", function () {
        initializeCharts();
        fetchAllData();
    });

    function initializeCharts() {
        // 当前天气图表
        const ctxCurrent = document.getElementById('currentWeatherChart').getContext('2d');
        currentWeatherChart = new Chart(ctxCurrent, {
            type: 'bar',
            data: {
                labels: ['温度 (°C)', '湿度 (%)', '紫外线指数'],
                datasets: [{
                    label: '当前天气数据',
                    data: [0, 0, 0], // 初始值
                    backgroundColor: ['var(--primary-color)', '#34c759', '#ff9500']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });

        // 气象数据图表
        const ctxPressure = document.getElementById('pressureDataChart').getContext('2d');
        pressureDataChart = new Chart(ctxPressure, {
            type: 'line',
            data: {
                labels: ['大气压 (hPa)', '能见度 (km)', '空气质量指数', '降水量 (mm)'],
                datasets: [{
                    label: '气象数据',
                    data: [0, 0, 0, 0], // 初始值
                    backgroundColor: 'rgba(75, 123, 219, 0.2)',
                    borderColor: 'rgba(75, 123, 219, 1)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });

        // 未来天气图表
        const ctxFuture = document.getElementById('futureWeatherChart').getContext('2d');
        futureWeatherChart = new Chart(ctxFuture, {
            type: 'line',
            data: {
                labels: [], // 动态填充
                datasets: [{
                    label: '未来七天天气预报',
                    data: [], // 动态填充
                    backgroundColor: 'rgba(75, 123, 219, 0.2)',
                    borderColor: 'rgba(75, 123, 219, 1)',
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: '#555'
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        min: 10,
                        max: 40,
                        title: {
                            display: true,
                            text: '温度 (°C)'
                        }
                    },
                }
            }
        });

        // 天气状态图表
        const ctxState = document.getElementById('weatherStateChart').getContext('2d');
        weatherStateChart = new Chart(ctxState, {
            type: 'doughnut',
            data: {
                labels: ['晴天', '多云', '小雨'],
                datasets: [{
                    label: '天气状态',
                    data: [0, 0, 0], // 初始值
                    backgroundColor: ['var(--primary-color)', '#34c759', '#ff3b30']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: '#555'
                        }
                    }
                }
            }
        });

        // 重要警报数据图表
        const ctxAlert = document.getElementById('alertDataChart').getContext('2d');
        alertDataChart = new Chart(ctxAlert, {
            type: 'bar',
            data: {
                labels: ['台风预警', '暴雨预警', '寒潮预警'],
                datasets: [{
                    label: '警报类型',
                    data: [0, 0, 0], // 初始值
                    backgroundColor: ['#ff3b30', '#ff9500', '#ffcc00']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        min: 0,
                        max: 10,
                        title: {
                            display: true,
                            text: '数量'
                        }
                    },
                }
            }
        });
    }
    function fetchAndProcessFutureWeather(callback) {
        if (!currentRegionId) {
            console.error("当前城市 ID 未设置。");
            return;
        }
        console.log("Fetching future weather data for regionId:", currentRegionId);
        fetch(`/api/weather/future?regionId=${currentRegionId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log("Fetched Future Weather Data:", data);
                if (Array.isArray(data) && data.length > 0) {
                    data.sort((a, b) => new Date(a.fxDate) - new Date(b.fxDate));
                    const firstRecord = data[0];
                    console.log("First Record after Sorting:", firstRecord);
                    callback(firstRecord);
                } else {
                    throw new Error("无效的数据格式或数据为空");
                }
            })
            .catch(error => {
                console.error('Error fetching future weather data:', error);
                callback(null);
            });
    }
    // 获取所有数据
    function fetchAllData() {
        fetchCurrentWeather();
        fetchPressureData();
        fetchFutureWeather();
        fetchWeatherState();
        fetchAlertData();
    }

    // 获取当前天气数据
    // 获取当前天气数据
    // 获取当前天气数据
    // 获取当前天气数据
    function fetchCurrentWeather() {
        fetchAndProcessFutureWeather(function(firstRecord) {
            if (firstRecord) {
                console.log("Current Weather - Pressure:", firstRecord.pressure);
                console.log("Current Weather - Visibility:", firstRecord.visibility);
                console.log("Current Weather - Precipitation:", firstRecord.precip);
                console.log("Current Weather - TempMax:", firstRecord.tempMax);
                console.log("Current Weather - Humidity:", firstRecord.humidity);
                console.log("Current Weather - UV Index:", firstRecord.uvIndex);

                document.getElementById('current-temp').innerText = firstRecord.tempMax + "°C";
                document.getElementById('current-humidity').innerText = firstRecord.humidity + "%";
                document.getElementById('current-uv').innerText = firstRecord.uvIndex;

                // 更新图表
                currentWeatherChart.data.datasets[0].data = [
                    parseFloat(firstRecord.tempMax) || 0,
                    parseFloat(firstRecord.humidity) || 0,
                    parseFloat(firstRecord.uvIndex) || 0
                ];
                currentWeatherChart.update();
            } else {
                // 使用默认数据
                document.getElementById('current-temp').innerText = "0°C";
                document.getElementById('current-humidity').innerText = "0%";
                document.getElementById('current-uv').innerText = "弱";

                currentWeatherChart.data.datasets[0].data = [25, 65, 3];
                currentWeatherChart.update();
            }
        });
    }    // 获取气象数据
    function fetchPressureData() {
        fetchAndProcessFutureWeather(function(firstRecord) {
            if (firstRecord) {
                console.log("Pressure Data - Pressure:", firstRecord.pressure);
                console.log("Pressure Data - Visibility:", firstRecord.visibility);
                console.log("Pressure Data - Precipitation:", firstRecord.precip);

                document.getElementById('pressure').innerText = firstRecord.pressure + " hPa";
                document.getElementById('visibility').innerText = firstRecord.visibility + " km";
                // 如果后端不提供 airQuality，可以移除以下行或设置为默认值
                // document.getElementById('air-quality').innerText = firstRecord.airQuality || "--";
                document.getElementById('precip').innerText = firstRecord.precip + " mm";

                // 更新图表
                pressureDataChart.data.datasets[0].data = [
                    parseFloat(firstRecord.pressure) || 0,
                    parseFloat(firstRecord.visibility) || 0,
                    // parseFloat(firstRecord.airQuality) || 0, // 移除 airQuality
                    parseFloat(firstRecord.precip) || 0
                ];
                pressureDataChart.data.labels = ['大气压 (hPa)', '能见度 (km)', '降水量 (mm)'];
                pressureDataChart.update();
            } else {
                // 使用默认数据
                document.getElementById('pressure').innerText = "0 hPa";
                document.getElementById('visibility').innerText = "0 km";
                // document.getElementById('air-quality').innerText = "0 (良好)"; // 移除 airQuality
                document.getElementById('precip').innerText = "0 mm";

                pressureDataChart.data.datasets[0].data = [1013, 110, 225];
                pressureDataChart.data.labels = ['大气压 (hPa)', '能见度 (km)', '降水量 (mm)'];
                pressureDataChart.update();
            }
        });
    }
    function fetchFutureWeather() {
        if (!currentRegionId) {
            console.error("当前城市 ID 未设置。");
            return;
        }
        fetch(`/api/weather/future?regionId=${currentRegionId}`)
            .then(response => response.json())
            .then(data => {
                // 确保数据按日期排序
                data.sort((a, b) => new Date(a.fxDate) - new Date(b.fxDate));
                if (data && data.length > 0) {
                    const labels = [];
                    const temperatures = [];

                    // 获取今天的日期（设置时间为午夜）
                    const today = new Date();
                    today.setHours(0,0,0,0);

                    // 星期名称数组
                    const dayNames = ["星期日","星期一","星期二","星期三","星期四","星期五","星期六"];

                    data.forEach((d, index) => {
                        if (index < 7) { // 确保不超过7天
                            const dateElement = document.getElementById(`future-date-${index}`);
                            const tempElement = document.getElementById(`future-temp-${index}`);
                            const dayElement = document.getElementById(`future-day-${index}`);
                            if (dateElement && tempElement && dayElement) {
                                const date = new Date(d.fxDate);
                                date.setHours(0,0,0,0);

                                // 更新日期，格式为 MM月DD日
                                dateElement.innerText = `${date.getMonth()+1}月${date.getDate()}日`;

                                // 计算与今天的天数差
                                const diffTime = date.getTime() - today.getTime();
                                const diffDays = Math.round(diffTime / (1000 * 60 * 60 * 24));

                                // 获取星期名称
                                let dayName;
                                if (diffDays === 0) {
                                    dayName = "今天";
                                } else if (diffDays === 1) {
                                    dayName = "明天";
                                } else if (diffDays === 2) {
                                    dayName = "后天";
                                } else {
                                    dayName = dayNames[date.getDay()];
                                }
                                dayElement.innerText = dayName;

                                // 更新温度和描述
                                tempElement.innerText = (d.tempMax ? d.tempMax + "°C" : "--") + ", " + (d.textDay || "--");

                                // 准备图表数据
                                labels.push(dayName);
                                temperatures.push(parseFloat(d.tempMax) || 0);
                            }
                        }
                    });

                    // 更新图表
                    futureWeatherChart.data.labels = labels;
                    futureWeatherChart.data.datasets[0].data = temperatures;
                    futureWeatherChart.update();
                }
            })
            .catch(error => {
                console.error('Error fetching future weather:', error);
                // 使用默认占位数据
                const defaultLabels = ['未知', '未知', '未知', '未知', '未知', '未知', '未知'];
                const defaultDates = ['x月x日', 'x月x日', 'x月x日', 'x月x日', 'x月x日', 'x月x日', 'x月x日'];
                const defaultTemps = ['--', '--', '--', '--', '--', '--', '--'];

                for (let i = 0; i < 7; i++) {
                    document.getElementById(`future-day-${i}`).innerText = defaultLabels[i];
                    document.getElementById(`future-date-${i}`).innerText = defaultDates[i];
                    document.getElementById(`future-temp-${i}`).innerText = defaultTemps[i];
                }

                futureWeatherChart.data.labels = defaultLabels;
                futureWeatherChart.data.datasets[0].data = [0, 0, 0, 0, 0, 0, 0];
                futureWeatherChart.update();
            });
    }

    // 获取天气状态数据
    // 获取天气状态数据
    function fetchWeatherState() {
        fetchAndProcessFutureWeather(function(firstRecord) {
            if (firstRecord) {
                console.log("Weather State - Current State:", firstRecord.textDay);

                document.getElementById('current-state').innerText = firstRecord.textDay || "--";

                // 假设 firstRecord.text_day 包含当前天气状态
                // 根据实际情况调整 stateCounts
                const stateCounts = {
                    '晴天': firstRecord.textDay === '晴天' ? 1 : 0,
                    '多云': firstRecord.textDay === '多云' ? 1 : 0,
                    '小雨': firstRecord.textDay === '小雨' ? 1 : 0
                };

                // 更新图表数据
                weatherStateChart.data.datasets[0].data = [
                    stateCounts['晴天'] || 0,
                    stateCounts['多云'] || 0,
                    stateCounts['小雨'] || 0
                ];

                weatherStateChart.update();
            } else {
                // 使用默认数据
                document.getElementById('current-state').innerText = "晴天";

                weatherStateChart.data.datasets[0].data = [70, 20, 10];
                weatherStateChart.update();
            }
        });
    }    // 获取重要警报数据
    // 获取重要警报数据
    function fetchAlertData() {
        fetchAndProcessFutureWeather(function(firstRecord) {
            if (firstRecord) {
                console.log("Alert Data - Alert Type:", firstRecord.alertType);
                console.log("Alert Data - Severity:", firstRecord.severity);
                console.log("Alert Data - Alert Time:", firstRecord.fxDate);

                document.getElementById('alert-type').innerText = firstRecord.alertType || "暂无预警";
                document.getElementById('alert-severity').innerText = firstRecord.severity || "无";
                document.getElementById('alert-time').innerText = firstRecord.fxDate ? new Date(firstRecord.fxDate).toLocaleString() : "2024-05-01 08:00";

                // 假设 alertType 包含 '台风预警', '暴雨预警', '寒潮预警'
                const alertCounts = {
                    '台风预警': firstRecord.alertType === '台风预警' ? 1 : 0,
                    '暴雨预警': firstRecord.alertType === '暴雨预警' ? 1 : 0,
                    '寒潮预警': firstRecord.alertType === '寒潮预警' ? 1 : 0
                };

                // 更新图表数据
                alertDataChart.data.datasets[0].data = [
                    alertCounts['台风预警'] || 0,
                    alertCounts['暴雨预警'] || 0,
                    alertCounts['寒潮预警'] || 0
                ];
                alertDataChart.update();
            } else {
                // 使用默认数据
                document.getElementById('alert-type').innerText = "暂无预警";
                document.getElementById('alert-severity').innerText = "无";
                document.getElementById('alert-time').innerText = "2024-05-01 08:00";

                alertDataChart.data.datasets[0].data = [7, 2, 1];
                alertDataChart.update();
            }
        });
    }
    document.addEventListener("DOMContentLoaded", function () {
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');
        fetchDefaultCityWeather();
        sidebarToggle.addEventListener('click', function () {
            if (sidebar.style.left === '0px') {
                sidebar.style.left = '-250px';
                sidebarToggle.style.left = '20px'; // Reset button position
            } else {
                sidebar.style.left = '0px';
                sidebarToggle.style.left = '270px'; // Move button to the right
            }
        });
    });

    // 按钮功能示例
    function refreshData() {
        if (!currentRegionId) {
            alert('请先选择一个城市以刷新数据。');
            return;
        }
        // 重新获取所有数据
        fetchAllData();
        alert('数据已刷新。');
    }

    function importData() {
        // 实现数据导入逻辑
        alert('导入数据功能尚未实现。');
    }

    function openSettings() {
        // 实现设置界面
        window.location.href = '/settings'; // Replace '/settings' with the actual URL of your settings page
    }
    $(function() {
        // 初始化模糊搜索
        $("#citySearch").autocomplete({
            source: function(request, response) {
                $.ajax({
                    url: "/api/regions/search",
                    data: { query: request.term },
                    success: function(data) {
                        console.log(data); // 调试用
                        response($.map(data, function(region) {
                            return {
                                label: region.name,  // 显示在联想列表中的内容
                                value: region.name,  // 输入框显示的内容
                                id: region.id        // 城市的唯一 ID
                            };
                        }));
                    },
                    error: function() {
                        alert('城市搜索失败，请稍后再试。');
                    }
                });
            },
            minLength: 1, // 输入一个字符后即触发搜索
            select: function(event, ui) {
                $("#citySearch").data('selected-id', ui.item.id);
                console.log("Selected city ID:", ui.item.id);  // 调试用
            }
        });
    });
    // 添加订阅功能
    $("#addCityBtn").click(function() {
        const cityName = $("#citySearch").val();
        const regionId = $("#citySearch").data('selected-id'); // 获取选中的城市ID

        if (!cityName || !regionId) {
            alert("请选择一个有效的城市");
            return;
        }

        // 发送 POST 请求，提交选中的城市 ID
        $.ajax({
            type: "POST",
            url: "/api/subscriptions",
            data: { regionId: regionId },
            success: function(response) {
                alert("成功订阅城市：" + cityName);
                fetchSubscriptions(); // 刷新用户的订阅列表
                getWeather(regionId); // 获取天气数据
            },
            error: function() {
                alert("添加订阅失败，请稍后再试。");
            }
        });
    });

    function getWeather(code) {
        fetch(`https://devapi.qweather.com/v7/weather/7d?location=${code}&key=8226ccf6174041f0bc6a4e9bb078bd05`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log(data);
                const map = new Map();
                map.set('weatherInfo', data.daily);
                map.set('fxLink', data.fxLink);
                const obj = Object.fromEntries(map);
                fetch('/weather/sevenday', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },

                    body: JSON.stringify(obj),
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                    })
                    .catch(error => console.error('Error sending data:', error));
            })
            .catch(error => console.error('Error:', error));
    }
    // 获取用户的订阅列表
    // 修改 fetchSubscriptions 函数
    function fetchSubscriptions() {
        $.ajax({
            type: "GET",
            url: "/api/subscriptions",
            success: function(data) {
                const subscriptionsDiv = $("#subscriptions");
                subscriptionsDiv.empty();
                const defaultCityId = data.defaultCityId ? data.defaultCityId.toString() : null;
                const subscriptions = data.subscriptions;
                subscriptions.forEach(function(region) {
                    const cityDiv = $("<div>")
                        .addClass("subscription-item")
                        .data("region-id", region.id)
                        .click(function() {
                            const selectedRegionId = $(this).data("region-id");
                            setDefaultCity(selectedRegionId);
                            currentRegionId = selectedRegionId; // 更新当前城市 ID
                            fetchAllData();
                            // 更新 UI
                            $(".subscription-item").removeClass("default-city");
                            $(this).addClass("default-city");
                            getWeather(selectedRegionId)
                        });

                    if (region.id.toString() === defaultCityId) {
                        cityDiv.addClass("default-city"); // 添加样式
                        currentRegionId = region.id; // 设置默认城市 ID
                    }

                    const cityName = $("<span>")
                        .text(region.name);

                    const deleteBtn = $("<button>")
                        .addClass("delete-btn")
                        .html("&times;")
                        .click(function(event) {
                            event.stopPropagation();
                            const regionId = $(this).parent().data("region-id");
                            deleteSubscription(regionId);
                        });

                    cityDiv.append(cityName);
                    cityDiv.append(deleteBtn);
                    subscriptionsDiv.append(cityDiv);
                });

                // 在订阅列表加载完成后加载默认城市天气
                fetchAllData();
            },
            error: function() {
                console.error("获取订阅列表失败");
            }
        });
    }
    function setDefaultCity(regionId) {
        console.log("Setting default city with regionId:", regionId); // 添加日志
        $.ajax({
            type: "POST",
            url: "/api/subscriptions/default",
            data: { regionId: regionId },
            success: function(response) {
                console.log("默认城市已更新");
            },
            error: function() {
                console.error("设置默认城市失败");
            }
        });
    }
    $(document).ready(function() {
        fetchDefaultCityWeather();

        fetchSubscriptions();
        fetchDefaultCityWeather();
    });

    function fetchDefaultCityWeather(defaultCityId) {
        if (defaultCityId) {
            fetchWeatherData(defaultCityId);
            // 更新UI，标记默认城市
            $(".subscription-item").removeClass("default-city");
            $(`.subscription-item[data-region-id='${defaultCityId}']`).addClass("default-city");
        } else {
            // 如果没有默认城市，使用第一个订阅城市
            const firstCityId = $(".subscription-item").first().data("region-id");
            if (firstCityId) {
                fetchWeatherData(firstCityId);
                // 更新UI
                $(".subscription-item").removeClass("default-city");
                $(`.subscription-item[data-region-id='${firstCityId}']`).addClass("default-city");
            }
        }
    }    function fetchWeatherData(regionId) {
        // 调用后端接口获取天气数据
        getWeather(regionId);
        fetch(`/api/weather/current?regionId=${regionId}`)
            .then(response => response.json())
            .then(data => {
                if (data) {
                    document.getElementById('current-temp').innerText = data.tempMax + "°C";
                    document.getElementById('current-humidity').innerText = data.humidity + "%";
                    document.getElementById('current-uv').innerText = data.uvIndex;

                    // 更新图表
                    currentWeatherChart.data.datasets[0].data = [
                        parseFloat(data.tempMax) || 0,
                        parseFloat(data.humidity) || 0,
                        parseFloat(data.uvIndex) || 0
                    ];
                    currentWeatherChart.update();
                }
            })
            .catch(error => {
                console.error('Error fetching weather data:', error);
                // 使用默认数据
                document.getElementById('current-temp').innerText = "0°C";
                document.getElementById('current-humidity').innerText = "0%";
                document.getElementById('current-uv').innerText = "弱";

                currentWeatherChart.data.datasets[0].data = [25, 65, 3];
                currentWeatherChart.update();
            });
    }
    function deleteSubscription(regionId) {
        $.ajax({
            type: "DELETE",
            url: "/api/subscriptions?regionId=" + regionId,
            success: function(response) {
                alert("已删除订阅");
                fetchSubscriptions(); // 刷新订阅列表
            },
            error: function() {
                alert("删除订阅失败，请稍后再试。");
            }
        });
    }


    // 页面加载时获取订阅列表
    $(document).ready(function() {
        // 清除缓存（可选，根据需求）
        if ('caches' in window) {
            caches.keys().then(function(names) {
                for (let name of names) {
                    caches.delete(name);
                }
            });
        }
    });
    // 导航按钮动画
    const btnGroup = document.getElementById('btnGroup');
    const mainBtn = document.getElementById('mainBtn');

    mainBtn.addEventListener('click', () => {
        btnGroup.classList.toggle('active');
        // 切换主按钮图标
        if (btnGroup.classList.contains('active')) {
            mainBtn.innerHTML = `
                <svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6 6L42 42" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M42 6L6 42" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            `; // 关闭图标
        } else {
            mainBtn.innerHTML = `
                <svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M7.94971 11.9497H39.9497" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M7.94971 23.9497H39.9497" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M7.94971 35.9497H39.9497" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            `; // 菜单图标
        }
    });
</script>
</body>
</html>